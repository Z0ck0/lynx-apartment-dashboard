# Lynx Apartment Dashboard - Metrics SQL Reference

This document lists all metrics used in the Lynx Apartment dashboard and shows how they connect to SQL/database concepts. Each metric is documented with its SQL-style expression, showing how it would be calculated using standard SQL aggregate functions, joins, and grouping operations. This serves as a teaching resource for SQL students learning how business metrics translate into database queries.

## Data Tables Overview

The dashboard uses three main data sources:
- **Bookings**: Individual booking records with guest information, dates, revenue, and per-stay expenses
- **Monthly_Costs**: Fixed monthly costs (electricity, water, property management fees) organized by year and month
- **Toiletries** (Consumables): Per-stay consumable items with unit prices and quantities

## Metrics Reference Table

| Metric Name | Where It Appears | Description (Plain Language) | Input Tables / Data Sources | SQL-style Expression / Logic | Aggregate Functions Used | Joins / Relations Between Tables | What This Metric Tells Us / How to Interpret |
|-------------|------------------|------------------------------|----------------------------|------------------------------|-------------------------|----------------------------------|----------------------------------------------|
| Reservations | Dashboard (All views), Reports | Number of completed bookings in the selected period | Bookings | `SELECT COUNT(*) AS reservations FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | COUNT | None | Shows booking volume. Higher numbers indicate more activity and potential revenue. |
| Total nights | Dashboard (All views), Reports | Sum of all booked nights in the selected period | Bookings | `SELECT SUM(nights) AS total_nights FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Total occupancy nights. Compare with available nights to understand utilization. |
| Occupancy (%) | Dashboard (All views), Reports | Percentage of available nights that were actually booked | Bookings, Calendar (calculated) | `SELECT (SUM(b.nights) / :nights_available) * 100 AS occupancy_pct FROM bookings b WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None (uses calculated nights_available) | Key efficiency metric. Higher occupancy means better utilization. Industry standard is typically 60-80%. |
| Total revenue (€) | Dashboard (All views), Reports | Total revenue from all stays in the selected period | Bookings | `SELECT SUM(revenue_for_stay_eur) AS total_revenue FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Primary income metric. Track trends over time to identify growth patterns. |
| Net Profit (€) | Dashboard (Overall view only), Reports | Net profit after per-stay expenses and fixed monthly costs | Bookings, Monthly_Costs | `SELECT SUM(b.revenue_for_stay_eur) - SUM(b.per_stay_expenses_eur) - SUM(mc.total_fixed_costs_eur) AS net_profit FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM | LEFT JOIN Monthly_Costs on year/month | True profitability indicator. Positive values mean the property is generating profit after all costs. |
| Net Income Before Fixed Costs (€) | Dashboard (All views), Reports | Net profit after per-stay expenses, before fixed monthly costs | Bookings | `SELECT SUM(revenue_for_stay_eur) - SUM(per_stay_expenses_eur) AS net_before_fixed FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Shows variable profitability. Useful for comparing different platforms or periods without fixed cost allocation. |
| Average price per night (€) / ADR | Dashboard (All views), Reports | Average revenue per booked night | Bookings | `SELECT SUM(revenue_for_stay_eur) / SUM(nights) AS adr FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None | Pricing efficiency metric. Compare with market rates to optimize pricing strategy. |
| Average stay (nights) | Dashboard (All views), Reports | Average length of stay per reservation | Bookings | `SELECT SUM(nights) / COUNT(*) AS avg_stay_nights FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, COUNT, division | None | Guest behavior indicator. Longer stays reduce turnover costs and increase revenue per booking. |
| Profit Margin (%) | Dashboard (Overall view only), Reports | Percentage of revenue that becomes profit after all costs | Bookings, Monthly_Costs | `SELECT ((SUM(b.revenue_for_stay_eur) - SUM(b.per_stay_expenses_eur) - SUM(mc.total_fixed_costs_eur)) / SUM(b.revenue_for_stay_eur)) * 100 AS profit_margin FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | LEFT JOIN Monthly_Costs on year/month | Profitability efficiency. Higher margins mean better cost control and pricing power. |
| Cost per Reservation (€) | Dashboard (All views), Reports | Average variable cost per booking | Bookings | `SELECT SUM(per_stay_expenses_eur) / COUNT(*) AS cost_per_reservation FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, COUNT, division | None | Cost efficiency per booking. Lower values indicate better operational efficiency. |
| Profit per Night (€) | Dashboard (Overall view only), Reports | Profitability per booked night | Bookings, Monthly_Costs | `SELECT (SUM(b.revenue_for_stay_eur) - SUM(b.per_stay_expenses_eur) - SUM(mc.total_fixed_costs_eur)) / SUM(b.nights) AS profit_per_night FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | LEFT JOIN Monthly_Costs on year/month | Nightly profitability. Compare across periods to track efficiency improvements. |
| Profit per Stay (€) | Dashboard (Overall view only), Reports | Average profit per booking | Bookings, Monthly_Costs | `SELECT (SUM(b.revenue_for_stay_eur) - SUM(b.per_stay_expenses_eur) - SUM(mc.total_fixed_costs_eur)) / COUNT(*) AS profit_per_stay FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, COUNT, division | LEFT JOIN Monthly_Costs on year/month | Booking-level profitability. Useful for understanding the value of each reservation. |
| Net Income per Night Before Fixed (€) | Dashboard (All views), Reports | Variable profit per night (before fixed costs) | Bookings | `SELECT (SUM(revenue_for_stay_eur) - SUM(per_stay_expenses_eur)) / SUM(nights) AS net_income_per_night FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None | Shows nightly profitability excluding fixed costs. Useful for scaling decisions. |
| Net Income per Stay Before Fixed (€) | Dashboard (All views), Reports | Variable profit per booking (before fixed costs) | Bookings | `SELECT (SUM(revenue_for_stay_eur) - SUM(per_stay_expenses_eur)) / COUNT(*) AS net_income_per_stay FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, COUNT, division | None | Booking-level profitability excluding fixed costs. Compare platforms on this metric. |
| Cost Percentage of Revenue (%) | Dashboard (All views), Reports | What portion of revenue goes to variable costs | Bookings | `SELECT (SUM(per_stay_expenses_eur) / SUM(revenue_for_stay_eur)) * 100 AS cost_pct_revenue FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None | Cost structure indicator. Lower percentages mean more revenue retained after variable costs. |
| Fixed Cost Percentage of Revenue (%) | Dashboard (All views), Reports | What portion of revenue covers fixed costs | Bookings, Monthly_Costs | `SELECT (SUM(mc.total_fixed_costs_eur) / SUM(b.revenue_for_stay_eur)) * 100 AS fixed_cost_pct FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | LEFT JOIN Monthly_Costs on year/month | Fixed cost burden. Lower percentages indicate better revenue relative to fixed expenses. |
| Revenue per Available Night (€) / RevPAR | Dashboard (All views), Reports | Revenue per available night (all days in period) | Bookings, Calendar (calculated) | `SELECT SUM(revenue_for_stay_eur) / :nights_available AS revpar FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None (uses calculated nights_available) | Industry-standard efficiency metric. Combines occupancy and pricing. Higher RevPAR means better overall performance. |
| Average Daily Rate (€) / ADR | Dashboard (All views), Reports | Average revenue per booked night (only occupied nights) | Bookings | `SELECT SUM(revenue_for_stay_eur) / SUM(nights) AS adr FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None | Pricing power indicator. Compare with market rates. Higher ADR with good occupancy means strong pricing strategy. |
| Airbnb revenue (€) | Dashboard (Airbnb, Comparison views), Reports | Total revenue coming from Airbnb bookings | Bookings | `SELECT SUM(revenue_for_stay_eur) AS airbnb_revenue FROM bookings WHERE platform = 'Airbnb' AND check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Platform-specific revenue. Track to understand which platform generates more income. |
| Booking.com revenue (€) | Dashboard (Booking.com, Comparison views), Reports | Total revenue coming from Booking.com bookings | Bookings | `SELECT SUM(revenue_for_stay_eur) AS booking_revenue FROM bookings WHERE platform = 'Booking.com' AND check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Platform-specific revenue. Compare with Airbnb to optimize channel mix. |
| Airbnb share of revenue (%) | Dashboard (All views), Reports | Percentage of total revenue generated via Airbnb | Bookings | `SELECT (SUM(CASE WHEN platform = 'Airbnb' THEN revenue_for_stay_eur ELSE 0 END) / SUM(revenue_for_stay_eur)) * 100 AS airbnb_share FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None | Channel diversification indicator. Over-reliance on one platform increases risk. |
| Booking.com share of revenue (%) | Dashboard (All views), Reports | Percentage of total revenue generated via Booking.com | Bookings | `SELECT (SUM(CASE WHEN platform = 'Booking.com' THEN revenue_for_stay_eur ELSE 0 END) / SUM(revenue_for_stay_eur)) * 100 AS booking_share FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None | Channel diversification indicator. Balanced distribution reduces platform dependency risk. |
| Airbnb nights | Dashboard (Airbnb, Comparison views), Reports | Total booked nights that came from Airbnb | Bookings | `SELECT SUM(nights) AS airbnb_nights FROM bookings WHERE platform = 'Airbnb' AND check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Platform occupancy volume. Compare with Booking.com to understand channel performance. |
| Booking.com nights | Dashboard (Booking.com, Comparison views), Reports | Total booked nights that came from Booking.com | Bookings | `SELECT SUM(nights) AS booking_nights FROM bookings WHERE platform = 'Booking.com' AND check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Platform occupancy volume. Compare with Airbnb to optimize channel strategy. |
| Airbnb Occupancy (%) | Dashboard (All views), Reports | Occupancy rate specifically from Airbnb | Bookings, Calendar (calculated) | `SELECT (SUM(CASE WHEN platform = 'Airbnb' THEN nights ELSE 0 END) / :nights_available) * 100 AS airbnb_occupancy FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None (uses calculated nights_available) | Platform-specific efficiency. Compare with Booking.com occupancy to identify stronger channel. |
| Booking.com Occupancy (%) | Dashboard (All views), Reports | Occupancy rate specifically from Booking.com | Bookings, Calendar (calculated) | `SELECT (SUM(CASE WHEN platform = 'Booking.com' THEN nights ELSE 0 END) / :nights_available) * 100 AS booking_occupancy FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None (uses calculated nights_available) | Platform-specific efficiency. Compare with Airbnb occupancy to optimize channel mix. |
| Airbnb RevPAR (€) | Dashboard (All views), Reports | Revenue per available night from Airbnb | Bookings, Calendar (calculated) | `SELECT SUM(CASE WHEN platform = 'Airbnb' THEN revenue_for_stay_eur ELSE 0 END) / :nights_available AS airbnb_revpar FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None (uses calculated nights_available) | Platform efficiency metric. Higher values indicate better Airbnb performance relative to capacity. |
| Booking.com RevPAR (€) | Dashboard (All views), Reports | Revenue per available night from Booking.com | Bookings, Calendar (calculated) | `SELECT SUM(CASE WHEN platform = 'Booking.com' THEN revenue_for_stay_eur ELSE 0 END) / :nights_available AS booking_revpar FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None (uses calculated nights_available) | Platform efficiency metric. Compare with Airbnb RevPAR to optimize channel strategy. |
| Airbnb ADR (€) | Dashboard (All views), Reports | Average daily rate from Airbnb | Bookings | `SELECT SUM(CASE WHEN platform = 'Airbnb' THEN revenue_for_stay_eur ELSE 0 END) / SUM(CASE WHEN platform = 'Airbnb' THEN nights ELSE 0 END) AS airbnb_adr FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None | Platform pricing power. Compare with Booking.com ADR to understand pricing differences. |
| Booking.com ADR (€) | Dashboard (All views), Reports | Average daily rate from Booking.com | Bookings | `SELECT SUM(CASE WHEN platform = 'Booking.com' THEN revenue_for_stay_eur ELSE 0 END) / SUM(CASE WHEN platform = 'Booking.com' THEN nights ELSE 0 END) AS booking_adr FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, division | None | Platform pricing power. Compare with Airbnb ADR to optimize pricing strategy. |
| Platform Profitability Difference (€) | Dashboard (Comparison view), Reports | Difference in profit per booking between Airbnb and Booking.com | Bookings | `SELECT (SUM(CASE WHEN platform = 'Airbnb' THEN revenue_for_stay_eur - per_stay_expenses_eur ELSE 0 END) / COUNT(CASE WHEN platform = 'Airbnb' THEN 1 END)) - (SUM(CASE WHEN platform = 'Booking.com' THEN revenue_for_stay_eur - per_stay_expenses_eur ELSE 0 END) / COUNT(CASE WHEN platform = 'Booking.com' THEN 1 END)) AS platform_profit_diff FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, COUNT, CASE, division | None | Platform comparison metric. Positive values mean Airbnb is more profitable per booking. |
| Average Stay Length by Platform (nights) | Dashboard (All views), Reports | Average booking duration by platform | Bookings | `SELECT platform, SUM(nights) / COUNT(*) AS avg_stay_length FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY platform;` | SUM, COUNT, division | GROUP BY platform | Guest behavior by channel. Longer stays reduce turnover costs and increase revenue per booking. |
| Platform Revenue per Reservation (€) | Dashboard (All views), Reports | Average booking value by platform | Bookings | `SELECT platform, SUM(revenue_for_stay_eur) / COUNT(*) AS revenue_per_reservation FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY platform;` | SUM, COUNT, division | GROUP BY platform | Channel value comparison. Higher values indicate more valuable bookings from that platform. |
| Platform Cost per Reservation (€) | Dashboard (All views), Reports | Average variable cost per booking by platform | Bookings | `SELECT platform, SUM(per_stay_expenses_eur) / COUNT(*) AS cost_per_reservation FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY platform;` | SUM, COUNT, division | GROUP BY platform | Cost efficiency by channel. Lower costs per booking mean better profitability from that platform. |
| Platform Mix (%) | Dashboard (All views), Reports | Share of bookings by platform | Bookings | `SELECT platform, (COUNT(*) * 100.0 / (SELECT COUNT(*) FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date)) AS platform_mix_pct FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY platform;` | COUNT, division, subquery | GROUP BY platform | Channel diversification. Balanced mix reduces dependency risk on a single platform. |
| Revenue Concentration Risk (%) | Dashboard (All views), Reports | How dependent you are on one platform | Bookings | `SELECT GREATEST((SUM(CASE WHEN platform = 'Airbnb' THEN revenue_for_stay_eur ELSE 0 END) / SUM(revenue_for_stay_eur)) * 100, (SUM(CASE WHEN platform = 'Booking.com' THEN revenue_for_stay_eur ELSE 0 END) / SUM(revenue_for_stay_eur)) * 100) AS revenue_concentration FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, CASE, GREATEST, division | None | Risk indicator. Values above 80% indicate high dependency on one channel. Diversify to reduce risk. |
| Average group size | Dashboard (All views), Reports | Average number of guests per stay | Bookings | `SELECT AVG(total_guests) AS avg_group_size FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | AVG | None | Guest behavior indicator. Larger groups may require more amenities but also generate more revenue. |
| Average Revenue per Stay (€) | Dashboard (All views), Reports | Average booking value | Bookings | `SELECT AVG(revenue_for_stay_eur) AS avg_revenue_per_stay FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | AVG | None | Booking value metric. Track trends to understand if average booking value is increasing. |
| Average Cost per Stay (€) | Dashboard (All views), Reports | Average variable cost per booking | Bookings | `SELECT AVG(per_stay_expenses_eur) AS avg_cost_per_stay FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | AVG | None | Cost efficiency per booking. Lower values indicate better operational efficiency. |
| Average Guests per Booking by Platform | Dashboard (All views), Reports | Average group size by platform | Bookings | `SELECT platform, AVG(total_guests) AS avg_guests FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY platform;` | AVG | GROUP BY platform | Guest behavior by channel. Different platforms may attract different group sizes. |
| Parking Usage (%) | Dashboard (All views), Reports | Percentage of bookings where parking was used | Bookings | `SELECT (COUNT(CASE WHEN parking = 'Yes' THEN 1 END) * 100.0 / COUNT(*)) AS parking_usage FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | COUNT, CASE, division | None | Amenity utilization. High usage may indicate need for parking availability or pricing. |
| Revenue per Guest (€) | Dashboard (All views), Reports | Average revenue per person | Bookings | `SELECT SUM(revenue_for_stay_eur) / SUM(total_guests) AS revenue_per_guest FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None | Per-guest value metric. Higher values indicate better revenue extraction per person. |
| Baby Crib usage (%) | Dashboard (All views), Reports | Percentage of bookings where the baby crib was used | Bookings | `SELECT (COUNT(CASE WHEN baby_crib = 'Yes' THEN 1 END) * 100.0 / COUNT(*)) AS baby_crib_usage FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | COUNT, CASE, division | None | Amenity utilization. Track to understand guest needs and optimize amenity offerings. |
| Sofa Bed usage (%) | Dashboard (All views), Reports | Percentage of bookings where the sofa bed was used | Bookings | `SELECT (COUNT(CASE WHEN sofa_bed = 'Yes' THEN 1 END) * 100.0 / COUNT(*)) AS sofa_bed_usage FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | COUNT, CASE, division | None | Amenity utilization. High usage indicates capacity flexibility is valued by guests. |
| Total Per-Stay Expenses (€) | Dashboard (All views), Reports | Sum of all variable per-stay costs | Bookings | `SELECT SUM(transportation_cost_eur + laundry_cost_eur + consumable_cost_eur + bank_fees_eur) AS total_per_stay_expenses FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM | None | Total variable costs. Track trends to identify cost reduction opportunities. |
| Total Fixed Costs (€) | Dashboard (All views), Reports | Sum of all fixed monthly costs for the selected period | Monthly_Costs | `SELECT SUM(total_fixed_costs_eur) AS total_fixed_costs FROM monthly_costs WHERE year = :year AND month BETWEEN :start_month AND :end_month;` | SUM | None | Fixed cost burden. These costs must be covered regardless of occupancy. |
| Average Cost per Night (€) | Dashboard (All views), Reports | Variable cost per booked night | Bookings | `SELECT SUM(per_stay_expenses_eur) / SUM(nights) AS avg_cost_per_night FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | None | Nightly cost efficiency. Lower values mean better cost control per night. |
| Fixed Cost per Night (€) | Dashboard (All views), Reports | Fixed cost allocation per booked night | Bookings, Monthly_Costs | `SELECT SUM(mc.total_fixed_costs_eur) / SUM(b.nights) AS fixed_cost_per_night FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | LEFT JOIN Monthly_Costs on year/month | Fixed cost burden per night. Higher occupancy spreads fixed costs across more nights. |
| Fixed Cost per Reservation (€) | Dashboard (All views), Reports | Fixed cost allocation per booking | Bookings, Monthly_Costs | `SELECT SUM(mc.total_fixed_costs_eur) / COUNT(*) AS fixed_cost_per_reservation FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, COUNT, division | LEFT JOIN Monthly_Costs on year/month | Fixed cost burden per booking. More bookings spread fixed costs across more reservations. |
| Variable vs Fixed Cost Ratio | Dashboard (All views), Reports | Ratio of variable to fixed costs | Bookings, Monthly_Costs | `SELECT SUM(b.per_stay_expenses_eur) / SUM(mc.total_fixed_costs_eur) AS variable_fixed_ratio FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, division | LEFT JOIN Monthly_Costs on year/month | Cost structure indicator. Higher ratios mean more scalable cost structure (more variable, less fixed). |
| Break-even Occupancy (%) | Dashboard (All views), Reports | Minimum occupancy needed to cover fixed costs | Bookings, Monthly_Costs, Calendar (calculated) | `SELECT (SUM(mc.total_fixed_costs_eur) / (AVG(b.revenue_for_stay_eur / b.nights) * :nights_available)) * 100 AS break_even_occupancy FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, AVG, division | LEFT JOIN Monthly_Costs on year/month | Critical threshold. Below this occupancy, you're losing money on fixed costs. |
| Break-even Nights | Dashboard (All views), Reports | Minimum nights needed to cover fixed costs | Bookings, Monthly_Costs | `SELECT SUM(mc.total_fixed_costs_eur) / AVG(b.revenue_for_stay_eur / b.nights) AS break_even_nights FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date;` | SUM, AVG, division | LEFT JOIN Monthly_Costs on year/month | Critical threshold. Below this number of nights, fixed costs aren't covered. |
| Best month by revenue | Dashboard (All views), Reports | Month and year with the highest total revenue | Bookings | `SELECT YEAR(check_in_date) AS year, MONTH(check_in_date) AS month, SUM(revenue_for_stay_eur) AS total_revenue FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY YEAR(check_in_date), MONTH(check_in_date) ORDER BY total_revenue DESC LIMIT 1;` | SUM | GROUP BY year, month, ORDER BY DESC, LIMIT | Peak performance indicator. Identify seasonal patterns and replicate successful strategies. |
| Best Month by Profit (€) | Dashboard (All views), Reports | Month and year with the highest profit | Bookings, Monthly_Costs | `SELECT YEAR(b.check_in_date) AS year, MONTH(b.check_in_date) AS month, SUM(b.revenue_for_stay_eur) - SUM(b.per_stay_expenses_eur) - SUM(mc.total_fixed_costs_eur) AS net_profit FROM bookings b LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date) WHERE b.check_in_date BETWEEN :start_date AND :end_date GROUP BY YEAR(b.check_in_date), MONTH(b.check_in_date) ORDER BY net_profit DESC LIMIT 1;` | SUM, subtraction | LEFT JOIN Monthly_Costs on year/month, GROUP BY year/month, ORDER BY DESC, LIMIT | Peak profitability indicator. Analyze what made this month successful. |
| Worst Month by Revenue (€) | Dashboard (All views), Reports | Month and year with the lowest revenue | Bookings | `SELECT YEAR(check_in_date) AS year, MONTH(check_in_date) AS month, SUM(revenue_for_stay_eur) AS total_revenue FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY YEAR(check_in_date), MONTH(check_in_date) ORDER BY total_revenue ASC LIMIT 1;` | SUM | GROUP BY year/month, ORDER BY ASC, LIMIT | Low performance indicator. Identify causes and develop strategies to improve. |
| Projected next-year revenue | Dashboard (All views), Reports | Simple projection: average monthly revenue × 12 | Bookings | `SELECT AVG(monthly_revenue) * 12 AS projected_revenue FROM (SELECT YEAR(check_in_date) AS year, MONTH(check_in_date) AS month, SUM(revenue_for_stay_eur) AS monthly_revenue FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY YEAR(check_in_date), MONTH(check_in_date)) monthly_stats;` | AVG, SUM, subquery | GROUP BY year/month in subquery | Basic revenue forecast. Use for planning and goal setting. |
| Projected Next-Year Revenue (Weighted) | Dashboard (All views), Reports | Weighted projection favoring recent performance | Bookings | `SELECT ((SELECT AVG(monthly_revenue) FROM (SELECT SUM(revenue_for_stay_eur) AS monthly_revenue FROM bookings WHERE check_in_date BETWEEN :recent_start AND :recent_end GROUP BY YEAR(check_in_date), MONTH(check_in_date)) recent) * 0.6 + (SELECT AVG(monthly_revenue) FROM (SELECT SUM(revenue_for_stay_eur) AS monthly_revenue FROM bookings WHERE check_in_date BETWEEN :older_start AND :older_end GROUP BY YEAR(check_in_date), MONTH(check_in_date)) older) * 0.4) * 12 AS weighted_projection;` | AVG, SUM, weighted calculation | GROUP BY year/month in subqueries | More accurate forecast. Recent trends weighted more heavily for better prediction. |
| Projected Next-Year Profit (€) | Dashboard (All views), Reports | Forecast profit based on weighted revenue projection | Bookings, Monthly_Costs | `SELECT :weighted_revenue_projection * (:avg_profit_margin / 100) AS projected_profit;` | Calculation using pre-calculated values | Uses calculated weighted revenue and profit margin | Profit forecast. Use for financial planning and investment decisions. |
| Month-over-Month Revenue Change (%) | Dashboard (All views), Reports | Percentage change in revenue from previous month | Bookings | `SELECT ((current.monthly_revenue - previous.monthly_revenue) / previous.monthly_revenue) * 100 AS mom_change FROM (SELECT SUM(revenue_for_stay_eur) AS monthly_revenue FROM bookings WHERE check_in_date >= DATE_SUB(CURDATE(), INTERVAL 1 MONTH) GROUP BY YEAR(check_in_date), MONTH(check_in_date) ORDER BY YEAR(check_in_date), MONTH(check_in_date) DESC LIMIT 1) current, (SELECT SUM(revenue_for_stay_eur) AS monthly_revenue FROM bookings WHERE check_in_date >= DATE_SUB(CURDATE(), INTERVAL 2 MONTH) AND check_in_date < DATE_SUB(CURDATE(), INTERVAL 1 MONTH) GROUP BY YEAR(check_in_date), MONTH(check_in_date) ORDER BY YEAR(check_in_date), MONTH(check_in_date) DESC LIMIT 1) previous;` | SUM, division, date functions | Subqueries for current and previous month | Short-term trend indicator. Positive values show growth momentum. |
| Year-over-Year Revenue Change (%) | Dashboard (All views), Reports | Percentage change in revenue compared to same period last year | Bookings | `SELECT ((current.total_revenue - previous.total_revenue) / previous.total_revenue) * 100 AS yoy_change FROM (SELECT SUM(revenue_for_stay_eur) AS total_revenue FROM bookings WHERE YEAR(check_in_date) = :current_year AND MONTH(check_in_date) BETWEEN :start_month AND :end_month) current, (SELECT SUM(revenue_for_stay_eur) AS total_revenue FROM bookings WHERE YEAR(check_in_date) = :previous_year AND MONTH(check_in_date) BETWEEN :start_month AND :end_month) previous;` | SUM, division | Subqueries for current and previous year | Long-term growth indicator. Accounts for seasonality by comparing same periods. |
| 3-Month Moving Average Revenue (€) | Dashboard (All views), Reports | Average revenue over the last 3 months | Bookings | `SELECT AVG(monthly_revenue) AS moving_avg_3m FROM (SELECT YEAR(check_in_date) AS year, MONTH(check_in_date) AS month, SUM(revenue_for_stay_eur) AS monthly_revenue FROM bookings WHERE check_in_date BETWEEN DATE_SUB(CURDATE(), INTERVAL 3 MONTH) AND CURDATE() GROUP BY YEAR(check_in_date), MONTH(check_in_date) ORDER BY YEAR(check_in_date), MONTH(check_in_date) DESC LIMIT 3) recent_months;` | AVG, SUM | GROUP BY year/month, ORDER BY DESC, LIMIT 3 | Smoothed trend indicator. Reduces month-to-month volatility to show underlying trends. |
| Seasonal Index | Dashboard (All views), Reports | Average seasonal index across all months | Bookings | `SELECT AVG((monthly_revenue / annual_avg) * 100) AS seasonal_index FROM (SELECT YEAR(check_in_date) AS year, MONTH(check_in_date) AS month, SUM(revenue_for_stay_eur) AS monthly_revenue, (SELECT AVG(monthly_rev) FROM (SELECT SUM(revenue_for_stay_eur) AS monthly_rev FROM bookings GROUP BY YEAR(check_in_date), MONTH(check_in_date)) all_months) AS annual_avg FROM bookings GROUP BY YEAR(check_in_date), MONTH(check_in_date)) monthly_with_avg;` | AVG, SUM, nested subqueries | GROUP BY year/month, nested aggregation | Seasonality indicator. Values above 100 indicate above-average months, below 100 indicate below-average. |
| Transportation Cost per Stay (€) | Dashboard (All views), Reports | Average transportation cost per booking | Bookings | `SELECT AVG(transportation_cost_eur) AS transportation_cost_per_stay FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | AVG | None | Transportation efficiency. Track to identify cost reduction opportunities. |
| Laundry Cost per Stay (€) | Dashboard (All views), Reports | Average laundry cost per booking | Bookings | `SELECT AVG(laundry_cost_eur) AS laundry_cost_per_stay FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | AVG | None | Laundry efficiency. Monitor for cost control and optimization opportunities. |
| Consumable Cost per Stay (€) | Dashboard (All views), Reports | Average consumable cost per booking | Bookings | `SELECT AVG(consumable_cost_eur) AS consumable_cost_per_stay FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | AVG | None | Consumable efficiency. Track to optimize supply costs and guest experience balance. |
| Bank Fees per Stay (€) | Dashboard (All views), Reports | Average bank fees per booking | Bookings | `SELECT AVG(bank_fees_eur) AS bank_fees_per_stay FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date;` | AVG | None | Payment processing efficiency. Consider alternative payment methods if fees are high. |
| Top Countries by Bookings | Dashboard (All views), Reports | Top 5 countries by number of bookings | Bookings | `SELECT country, COUNT(*) AS bookings FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY country ORDER BY bookings DESC LIMIT 5;` | COUNT | GROUP BY country, ORDER BY DESC, LIMIT 5 | Guest origin analysis. Understand your market and tailor marketing to top countries. |
| Top Countries by Revenue | Dashboard (All views), Reports | Top 5 countries by total revenue | Bookings | `SELECT country, SUM(revenue_for_stay_eur) AS total_revenue FROM bookings WHERE check_in_date BETWEEN :start_date AND :end_date GROUP BY country ORDER BY total_revenue DESC LIMIT 5;` | SUM | GROUP BY country, ORDER BY DESC, LIMIT 5 | Revenue source analysis. Focus marketing efforts on high-value country markets. |

## Notes on SQL Expressions

1. **Date Filtering**: Most queries use `WHERE check_in_date BETWEEN :start_date AND :end_date` to filter by the selected period. In practice, these would be parameterized values.

2. **Platform Filtering**: Platform-specific metrics use `WHERE platform = 'Airbnb'` or `WHERE platform = 'Booking.com'`, or `CASE WHEN platform = ...` for conditional aggregation.

3. **Joins**: The `Monthly_Costs` table is joined to `Bookings` using year and month: `LEFT JOIN monthly_costs mc ON mc.year = YEAR(b.check_in_date) AND mc.month = MONTH(b.check_in_date)`.

4. **Calculated Values**: Some metrics like `nights_available` are calculated based on the period type (month, year, or date range) and are represented as `:nights_available` parameters in the SQL expressions.

5. **Aggregate Functions**: The most commonly used aggregate functions are:
   - `SUM()`: For totaling revenue, costs, nights
   - `COUNT()`: For counting bookings/reservations
   - `AVG()`: For calculating averages
   - `MAX()` / `MIN()`: For finding best/worst months (implicit in ORDER BY + LIMIT)

6. **Grouping**: Many metrics use `GROUP BY` to aggregate by platform, country, year, or month.

7. **Window Functions**: Some advanced metrics could use window functions (like `LAG()` for month-over-month comparisons), but are shown here using subqueries for clarity.

## Learning Points for SQL Students

- **Aggregation**: Most metrics use aggregate functions to summarize data across multiple rows
- **Joins**: Understanding how to join tables on date-based keys (year/month) is crucial for combining booking and cost data
- **Filtering**: Using WHERE clauses with date ranges and platform filters to segment data
- **Grouping**: GROUP BY is essential for platform-specific, country-specific, or time-period-specific metrics
- **Subqueries**: Complex metrics often require subqueries to calculate intermediate values (like monthly averages before calculating projections)
- **CASE Statements**: Conditional aggregation using CASE WHEN allows calculating platform-specific metrics in a single query
- **Calculated Columns**: Many metrics involve division or percentage calculations using aggregate results

